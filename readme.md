

## Preliminary build instructions

Please note this project is in very early stages.  It is expected these build instructions will change and become more robust as the project evolves.  The current build instructions are for early adapters to test and give us feedback.  Where things need improvement we've added notes and are very happy to get feedback.  

## pre-requisites

### Install a c++ compiler

For windows look at the [CLIc_prototype windows build guide](https://github.com/clEsperanto/CLIc_prototype/blob/master/docs/windows_build/windows_build.md) and install Visual Studio community edition. 

### Install OpenCL

Note.  As we create builds for different operating systems these instructions may change.  

Currently we have only built on Windows using the Nvidia distribution of OpenCL version 11.2

The OpenCL include and lib folders are defined [here](https://github.com/clEsperanto/clesperantoj_prototype/blob/javacpp/src/main/java/net/clesperanto/clicwrapper/clesperantoj.java#L17)

If you have a different version of OpenCL please feel free to experiement and change the above location.

TODO:  Define OpenCl location in a more robust way. 

### Set the environment variable JAVA_HOME to a valid SDK, e.g.:

```
setx JAVA_HOME C:\Users\rober\.jdks\azul-11.0.14.1\
echo %JAVA_HOME%
```

### Download apache-maven, unzip it and make it part of PATH:

```
C:\programs\apache-maven-3.8.4-bin\apache-maven-3.8.4\bin
```

### Install git for windows (for access to git bash)

[Git for windows](https://git-scm.com/download/win) can be found here.

### Install CLIc_prototype 

Get [CLIc_prototype](https://github.com/clEsperanto/CLIc_prototype) and put code in the same directory as ```clesperantoj_prototype```.

Then build and install using ```CLIc_prototype/build``` as the folder to place the build files generated by cmake and ```CLIc_prototype/bin``` as the installation folder where the binaries will be placed.  It is important to use this code and installation folder as ```clesperantoj_protyotype``` uses them as include and link paths. 

If using the cmake windows GUI and visual studio GUI 

1.  Project Build files are specified by changing the 'Where to build the binaries' option
2.  The installation folder is specified by the CMAKE_INSTALL_PREFIC option

If using cmake from command line

In this case you need to use a bash prompt embedded in the x64 Native Tools command prompt.  

Open the x64 Native Tools Command Prompt for VS 2019 (64 bit!), then run 'C:\Program Files\Git\bin\sh.exe' (optionally add 'C:\Program Files\Git\bin\' to windows path and then just type sh), then navigate to the root directory of this project and run

'''
cmake -S . -B ./build -D CMAKE_INSTALL_PREFIX=/path/to/installation/folder
cmake --build ./build --parallel 10 --target install
'''

You can modify installation location using -D CMAKE_INSTALL_PREFIX=/path/to/installation/folder

## Build clesperantij_prototype

Open the x64 Native Tools Command Prompt for VS 2019 (64 bit!), then run 'C:\Program Files\Git\bin\sh.exe' (optionally add 'C:\Program Files\Git\bin\' to windows path and then just type sh), then navigate to the root directory of this project and run

```
mvn
```

(Note:  I've sometimes had to make a trivial change to [clesperantoj][https://github.com/clEsperanto/clesperantoj_prototype/blob/javacpp/src/main/java/net/clesperanto/clicwrapper/clesperantoj.java], like adding a space, to activate the parser that generated the java wrapper.)  


## Trouble shooting

Take a look at the ```javacpp``` section of the poml.xml and make sure the ```includePath``` and ```linkPath``` locations exist on your machine. 


## SWIG Links
http://www.swig.org/tutorial.html
https://valelab4.ucsf.edu/svn/3rdpartypublic/swig/Doc/Manual/Java.html